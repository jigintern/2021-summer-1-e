<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="home.css">
        <title>TRIP LIST</title>
        <script type=module>
            import { create, add, style, h1, inp, div, link } from "https://js.sabae.cc/stdom.js";
            import { CSV } from "https://code4sabae.github.io/js/CSV.js";
            import { shuffle } from "https://js.sabae.cc/shuffle.js";
            import { search } from "https://js.sabae.cc/search.js";
            
            window.onload = async () => {
              // ページ構築
              const inputfilter = docment.getElementById("kensaku");
              const res = div();
              credit();
              style({ a: { color: "gray !important" }});
            
              // データ読み込み
              const url = "https://code4fukui.github.io/find47/find47images.csv";
              const data = CSV.toJSON(await CSV.fetch(url));
              console.log(data);
              shuffle(data);
            
              // 検索表示機能
              inputfilter.onchange = inputfilter.onkeyup = () => {
                const hits = search(data, inputfilter.value);
                document.location.hash = "#" + inputfilter.value;
                console.log(hits, hits.length);
                res.innerHTML = "";
                for (const d of hits) {
                  const div = create("div");
                  div.style.margin = "1vw 0";
            
                  const img = new Image();
                  img.style.width = "50vw";
                  img.loading = "lazy"; // 画像は表示するときに読み込み
                  img.src = d.url_thumb;
                  div.appendChild(img);
         
                  res.appendChild(div);
                }
              };
            
              // 初期画面
              inputfilter.value = decodeURIComponent(document.location.hash.substring(1)) || "福井";
              inputfilter.onchange();
            };
            const credit = () => {
              add("hr");
              link("写真 CC BY FIND47", "https://find47.jp/");
              link("データ CC BY Code for Fukui", "https://github.com/code4fukui/find47/");
              link("アプリ CC BY Code for Fukui", "https://fukuno.jig.jp/3226");
            };
            </script>
    </head>
    <body>

        <h1>TRIP LIST</h1>
        <input  id="kensaku"  />
        <input type="submit" value="検索" />


    </body>
</html>